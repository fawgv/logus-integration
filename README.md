# Logus HMS Integration Example

# Сообщения

В процессе работы Логус отправляет в шину сообщения. Любая заинтересованная система может подписаться на любой тип сообщения и гарантированно получать их из интеграционной шины. Перечень сообщений и примерный состав данных приведены в следующих разделах.

## ReservationUpdatedMessage

Сообщение отправляется при любом изменении брони: изменение полей (комментарий, номер телефона гостя и т.п.), длительности, тарифов, начислении на счёт брони и т.п.

Тело сообщения содержит всю информацию по брони:

1. Все основные и допольнительные поля (настраиваемые через интерфейс администрирования)
2. Информацию по каждому гостю брони
3. Информацию о размещении с детализацией по дням (тариф, тип комнаты, кол-во гостей, пакеты и услуги, стоимость проживания)

Важно отметить, что при изменении состояния брони также отправляется сообщение *ReservationUpdatedMessage*

## ReservationStatusChangedMessage

Сообщение отправляется при изменении состояния брони (поселение, выселение, отмена и т.п.). По атрибутивному составу идентично *ReservationUpdatedMessage* плюс содержит дополнительный признак *PreviousStatus* - идентификатор предыдущего состояния.

## GuestProfileUpdatedMessage

Возникает при любых изменениях в профиле гостя.

Содержит полную информацию по профилю, включая дополнительные поля, баланс профиля, телефоны, данные о документе (паспорт, св-во о рождении и т.п.)

## RoomOccupationChangedMessage

Сообщение отправляется в шину при изменении состояния занятости комнаты (поселение и выселение гостя). Содержит информацию о комнате, идентфикаторах заселяющейся или выезжающей брони.


## AvailabilityChangedEvent

Сообщение об изменении наличия в номерном фонде. Отправляется в случаях, которые могут повлечь изменение количества свободных номеров. Содержит в себе информацию о:

1. Временном периоде, за который наличие изменяется
2. Типе комнаты
3. Квоте (если наличие изменяется в рамках квоты)

## GroupBookingUpdatedMessage

Сообщение отправляется при любом изменении групповой брони: изменение полей, статуса, депозита, гарантий, компаний и т.п.

Тело сообщения содержит всю информацию по групповой брони:

1. Все основные и дополнительные поля (настраиваемые через интерфейс администрирования)
2. Информацию о статусе группы
3. Информацию о компаниях (компания-организатор и компания-плательщик)
4. Информацию о депозите (сумма и дата депозита)
5. Вид гарантии
6. Теги группы
7. Транзакции счёта группы

## CompanyProfileUpdatedMessage

Сообщение отправляется при любых изменениях в профиле компании.

Содержит полную информацию по профилю компании, включая дополнительные поля, баланс профиля, контактную информацию и т.п.

## PropertyChangedEvent

Сообщение отправляется при изменении данных об объекте (отеле). Может использоваться для синхронизации настроек отеля, информации об объекте и его конфигурации.

Содержит актуальные данные об объекте, включая идентификатор, название, адрес и другие параметры.

## AuditCompletedEvent

Сообщение отправляется после завершения ночного аудита. Содержит информацию о результате выполнения аудита:

1. Признак успешного завершения аудита
2. Дата, которую обработал аудит (последний закрытый день)

Может использоваться внешними системами для синхронизации финансовых данных и запуска процессов, зависящих от завершения аудита.

# Команды

Команды представляют собой особый вид сообщений, который внешняя система может направить в Логус для выполнения определённого действия или операции. В ответ на команду Логус может отправлять сообщения-ответы. Поддерживаемые команды перечислены ниже.

## CreateReservationRequest
Запрос на создание новой брони. Реализован в соответствии со спецификацей *OpenTravel Alliance*.

## PostTransactionsRequest
Данный запрос позволяет осуществлять начисление услуги или фиксирование платежа на любой счёт в Логусе (на счёт брони, группы, профиля гостя или компании). Из основных ключевых особенностей следует выделить такие:

1. Поддержка начислений по номеру счёта (который совпадает с номером брони, группы, компании, гостя и т.п.)
2. Поддержка начислений с детализацией
3. Поддержка начислений с группировкой транзакций в "финансовый документ" - счёт на оплату или путёвку
4. Поддержка "холостых" начислений, когда фактически сумма не начисляется на счёт, но в ответ Логус отправит информацию по состоянию баланса карманов и баланса счёта как если бы начисление было произведено. Это даёт возможность управлять депозитами и следить за балансом гостя/счёта.

## CancelTransactionRequest
Запрос на корректировку ранее начисленной транзакции/транзакций.

## CancelInvoiceRequest
Запрос на корректировку (отмену) финансового документа (счёта на оплату или путёвки)

## CreateGuestProfileRequest
Команда на создание нового профиля гостя в Логусе.
